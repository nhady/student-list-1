node{
  def app
  
  stage('Clone') {
    checkout scm
  }
  
  stage('Build image') {
    app = docker.build("4dvop-image", "./simple_api/")
  }
  
  stage('Test image') {
    docker.image('4dvop-image').withRun("--name 4dvopscontainer --network=default_default --link c11 --expose 5000 -p 5000:5000 -v /doc/student_age.json:/data/student_age.json"){c ->
      sh 'docker ps'
      sh 'docker inspect 4dvopscontainer'
      sh'curl -u "toto:python" -X GET http://172.21.0.3:5000/pozos/api/v1.0/get_student_ages'
    
    }
  }
}
