node{
  def app
  
  stage('Clone') {
    checkout scm
  }
  
  stage('Build image') {
    app = docker.build("my_image", "./simple_api/")
  }
  
  stage('Test image') {
    docker.image('my_image').withRun("--name test1 -p 5000:5000 -e DEBUG=true"){c ->
      sh 'docker ps'
      sh 'netstat -lntp'
      sh 'docker inspect testA | grep "IPAddress"'
      sh 'curl -u toto:python -X GET http://172.0.0.11:5000/pozos/api/v1.0/get_student_ages'
      
    }
  }
}
